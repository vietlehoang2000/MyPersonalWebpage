{"ast":null,"code":"import _objectSpread from \"/Users/vietle/Documents/personal-project/MyPersonalWebpage/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _classCallCheck from \"/Users/vietle/Documents/personal-project/MyPersonalWebpage/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/vietle/Documents/personal-project/MyPersonalWebpage/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { whichButtons, getOffsetPosition } from './event-utils';\nvar DEFAULT_OPTIONS = {\n  srcElement: 'root',\n  priority: 0\n};\nvar EventRegistrar = /*#__PURE__*/function () {\n  function EventRegistrar(eventManager) {\n    var _this = this;\n    _classCallCheck(this, EventRegistrar);\n    /**\n     * Handles hammerjs event\n     */\n    this.handleEvent = function (event) {\n      if (_this.isEmpty()) {\n        return;\n      }\n      var mjolnirEvent = _this._normalizeEvent(event);\n      var target = event.srcEvent.target;\n      while (target && target !== mjolnirEvent.rootElement) {\n        _this._emit(mjolnirEvent, target);\n        if (mjolnirEvent.handled) {\n          return;\n        }\n        target = target.parentNode;\n      }\n      _this._emit(mjolnirEvent, 'root');\n    };\n    this.eventManager = eventManager;\n    this.handlers = [];\n    // Element -> handler map\n    this.handlersByElement = new Map();\n    this._active = false;\n  }\n  // Returns true if there are no non-passive handlers\n  _createClass(EventRegistrar, [{\n    key: \"isEmpty\",\n    value: function isEmpty() {\n      return !this._active;\n    }\n  }, {\n    key: \"add\",\n    value: function add(type, handler, options) {\n      var once = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      var passive = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n      var handlers = this.handlers,\n        handlersByElement = this.handlersByElement;\n      var opts = DEFAULT_OPTIONS;\n      if (typeof options === 'string' || options && options.addEventListener) {\n        // is DOM element, backward compatibility\n        // @ts-ignore\n        opts = _objectSpread(_objectSpread({}, DEFAULT_OPTIONS), {}, {\n          srcElement: options\n        });\n      } else if (options) {\n        opts = _objectSpread(_objectSpread({}, DEFAULT_OPTIONS), options);\n      }\n      var entries = handlersByElement.get(opts.srcElement);\n      if (!entries) {\n        entries = [];\n        handlersByElement.set(opts.srcElement, entries);\n      }\n      var entry = {\n        type: type,\n        handler: handler,\n        srcElement: opts.srcElement,\n        priority: opts.priority\n      };\n      if (once) {\n        entry.once = true;\n      }\n      if (passive) {\n        entry.passive = true;\n      }\n      handlers.push(entry);\n      this._active = this._active || !entry.passive;\n      // Sort handlers by descending priority\n      // Handlers with the same priority are excuted in the order of registration\n      var insertPosition = entries.length - 1;\n      while (insertPosition >= 0) {\n        if (entries[insertPosition].priority >= entry.priority) {\n          break;\n        }\n        insertPosition--;\n      }\n      entries.splice(insertPosition + 1, 0, entry);\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(type, handler) {\n      var handlers = this.handlers,\n        handlersByElement = this.handlersByElement;\n      for (var i = handlers.length - 1; i >= 0; i--) {\n        var entry = handlers[i];\n        if (entry.type === type && entry.handler === handler) {\n          handlers.splice(i, 1);\n          var entries = handlersByElement.get(entry.srcElement);\n          entries.splice(entries.indexOf(entry), 1);\n          if (entries.length === 0) {\n            handlersByElement.delete(entry.srcElement);\n          }\n        }\n      }\n      this._active = handlers.some(function (entry) {\n        return !entry.passive;\n      });\n    }\n    /**\n     * Invoke handlers on a particular element\n     */\n  }, {\n    key: \"_emit\",\n    value: function _emit(event, srcElement) {\n      var entries = this.handlersByElement.get(srcElement);\n      if (entries) {\n        var immediatePropagationStopped = false;\n        // Prevents the current event from bubbling up\n        var stopPropagation = function stopPropagation() {\n          event.handled = true;\n        };\n        // Prevent any remaining listeners from being called\n        var stopImmediatePropagation = function stopImmediatePropagation() {\n          event.handled = true;\n          immediatePropagationStopped = true;\n        };\n        var entriesToRemove = [];\n        for (var i = 0; i < entries.length; i++) {\n          var _entries$i = entries[i],\n            type = _entries$i.type,\n            handler = _entries$i.handler,\n            once = _entries$i.once;\n          handler(_objectSpread(_objectSpread({}, event), {}, {\n            // @ts-ignore\n            type: type,\n            stopPropagation: stopPropagation,\n            stopImmediatePropagation: stopImmediatePropagation\n          }));\n          if (once) {\n            entriesToRemove.push(entries[i]);\n          }\n          if (immediatePropagationStopped) {\n            break;\n          }\n        }\n        for (var _i = 0; _i < entriesToRemove.length; _i++) {\n          var _entriesToRemove$_i = entriesToRemove[_i],\n            _type = _entriesToRemove$_i.type,\n            _handler = _entriesToRemove$_i.handler;\n          this.remove(_type, _handler);\n        }\n      }\n    }\n    /**\n     * Normalizes hammerjs and custom events to have predictable fields.\n     */\n  }, {\n    key: \"_normalizeEvent\",\n    value: function _normalizeEvent(event) {\n      var rootElement = this.eventManager.getElement();\n      return _objectSpread(_objectSpread(_objectSpread(_objectSpread({}, event), whichButtons(event)), getOffsetPosition(event, rootElement)), {}, {\n        preventDefault: function preventDefault() {\n          event.srcEvent.preventDefault();\n        },\n        stopImmediatePropagation: null,\n        stopPropagation: null,\n        handled: false,\n        rootElement: rootElement\n      });\n    }\n  }]);\n  return EventRegistrar;\n}();\nexport { EventRegistrar as default };","map":{"version":3,"names":["whichButtons","getOffsetPosition","DEFAULT_OPTIONS","srcElement","priority","EventRegistrar","eventManager","_this","_classCallCheck","handleEvent","event","isEmpty","mjolnirEvent","_normalizeEvent","target","srcEvent","rootElement","_emit","handled","parentNode","handlers","handlersByElement","Map","_active","_createClass","key","value","add","type","handler","options","once","arguments","length","undefined","passive","opts","addEventListener","_objectSpread","entries","get","set","entry","push","insertPosition","splice","remove","i","indexOf","delete","some","immediatePropagationStopped","stopPropagation","stopImmediatePropagation","entriesToRemove","_entries$i","_entriesToRemove$_i","getElement","preventDefault","default"],"sources":["../../../src/utils/event-registrar.ts"],"sourcesContent":[null],"mappings":";;;AACA,SAAQA,YAAY,EAAEC,iBAAiB,QAAO,eAAe;AAe7D,IAAMC,eAAe,GAAmB;EACtCC,UAAU,EAAE,MAAM;EAClBC,QAAQ,EAAE;CACX;AAAC,IAEmBC,cAAc;EAOjC,SAAAA,eAAYC,YAA0B;IAAA,IAAAC,KAAA;IAAAC,eAAA,OAAAH,cAAA;IAkFtC;;;IAGA,KAAAI,WAAW,GAAG,UAACC,KAAsB,EAAI;MACvC,IAAIH,KAAI,CAACI,OAAO,EAAE,EAAE;QAClB;;MAGF,IAAMC,YAAY,GAAGL,KAAI,CAACM,eAAe,CAACH,KAAK,CAAC;MAChD,IAAII,MAAM,GAAGJ,KAAK,CAACK,QAAQ,CAACD,MAAqB;MAEjD,OAAOA,MAAM,IAAIA,MAAM,KAAKF,YAAY,CAACI,WAAW,EAAE;QACpDT,KAAI,CAACU,KAAK,CAACL,YAAY,EAAEE,MAAM,CAAC;QAChC,IAAIF,YAAY,CAACM,OAAO,EAAE;UACxB;;QAEFJ,MAAM,GAAGA,MAAM,CAACK,UAAyB;;MAE3CZ,KAAI,CAACU,KAAK,CAACL,YAAY,EAAE,MAAM,CAAC;IAClC,CAAC;IApGC,IAAI,CAACN,YAAY,GAAGA,YAAY;IAChC,IAAI,CAACc,QAAQ,GAAG,EAAE;IAClB;IACA,IAAI,CAACC,iBAAiB,GAAG,IAAIC,GAAG,EAAE;IAElC,IAAI,CAACC,OAAO,GAAG,KAAK;EACtB;EAEA;EAAAC,YAAA,CAAAnB,cAAA;IAAAoB,GAAA;IAAAC,KAAA,EACA,SAAAf,QAAA,EAAO;MACL,OAAO,CAAC,IAAI,CAACY,OAAO;IACtB;EAAC;IAAAE,GAAA;IAAAC,KAAA,EAED,SAAAC,IACEC,IAAY,EACZC,OAAsC,EACtCC,OAAqC,EAEb;MAAA,IADxBC,IAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAgB,KAAK;MAAA,IACrBG,OAAA,GAAAH,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAmB,KAAK;MAExB,IAAOZ,QAAQ,GAAuB,IAAI,CAAnCA,QAAQ;QAAEC,iBAAiB,GAAI,IAAI,CAAzBA,iBAAiB;MAClC,IAAIe,IAAI,GAAmBlC,eAAe;MAE1C,IAAI,OAAO4B,OAAO,KAAK,QAAQ,IAAKA,OAAO,IAAKA,OAAuB,CAACO,gBAAiB,EAAE;QACzF;QACA;QACAD,IAAI,GAAAE,aAAA,CAAAA,aAAA,KAAOpC,eAAe;UAAEC,UAAU,EAAE2B;QAAO,EAAC;OACjD,MAAM,IAAIA,OAAO,EAAE;QAClBM,IAAI,GAAAE,aAAA,CAAAA,aAAA,KAAOpC,eAAe,GAAK4B,OAAO,CAAC;;MAGzC,IAAIS,OAAO,GAAGlB,iBAAiB,CAACmB,GAAG,CAACJ,IAAI,CAACjC,UAAU,CAAC;MACpD,IAAI,CAACoC,OAAO,EAAE;QACZA,OAAO,GAAG,EAAE;QACZlB,iBAAiB,CAACoB,GAAG,CAACL,IAAI,CAACjC,UAAU,EAAEoC,OAAO,CAAC;;MAEjD,IAAMG,KAAK,GAAiB;QAC1Bd,IAAI,EAAJA,IAAI;QACJC,OAAO,EAAPA,OAAO;QACP1B,UAAU,EAAEiC,IAAI,CAACjC,UAAU;QAC3BC,QAAQ,EAAEgC,IAAI,CAAChC;OAChB;MACD,IAAI2B,IAAI,EAAE;QACRW,KAAK,CAACX,IAAI,GAAG,IAAI;;MAEnB,IAAII,OAAO,EAAE;QACXO,KAAK,CAACP,OAAO,GAAG,IAAI;;MAEtBf,QAAQ,CAACuB,IAAI,CAACD,KAAK,CAAC;MACpB,IAAI,CAACnB,OAAO,GAAG,IAAI,CAACA,OAAO,IAAI,CAACmB,KAAK,CAACP,OAAO;MAE7C;MACA;MACA,IAAIS,cAAc,GAAGL,OAAO,CAACN,MAAM,GAAG,CAAC;MACvC,OAAOW,cAAc,IAAI,CAAC,EAAE;QAC1B,IAAIL,OAAO,CAACK,cAAc,CAAC,CAACxC,QAAQ,IAAIsC,KAAK,CAACtC,QAAQ,EAAE;UACtD;;QAEFwC,cAAc,EAAE;;MAElBL,OAAO,CAACM,MAAM,CAACD,cAAc,GAAG,CAAC,EAAE,CAAC,EAAEF,KAAK,CAAC;IAC9C;EAAC;IAAAjB,GAAA;IAAAC,KAAA,EAED,SAAAoB,OAAOlB,IAAY,EAAEC,OAAsC;MACzD,IAAOT,QAAQ,GAAuB,IAAI,CAAnCA,QAAQ;QAAEC,iBAAiB,GAAI,IAAI,CAAzBA,iBAAiB;MAElC,KAAK,IAAI0B,CAAC,GAAG3B,QAAQ,CAACa,MAAM,GAAG,CAAC,EAAEc,CAAC,IAAI,CAAC,EAAEA,CAAC,EAAE,EAAE;QAC7C,IAAML,KAAK,GAAGtB,QAAQ,CAAC2B,CAAC,CAAC;QAEzB,IAAIL,KAAK,CAACd,IAAI,KAAKA,IAAI,IAAIc,KAAK,CAACb,OAAO,KAAKA,OAAO,EAAE;UACpDT,QAAQ,CAACyB,MAAM,CAACE,CAAC,EAAE,CAAC,CAAC;UACrB,IAAMR,OAAO,GAAGlB,iBAAiB,CAACmB,GAAG,CAACE,KAAK,CAACvC,UAAU,CAAC;UACvDoC,OAAO,CAACM,MAAM,CAACN,OAAO,CAACS,OAAO,CAACN,KAAK,CAAC,EAAE,CAAC,CAAC;UACzC,IAAIH,OAAO,CAACN,MAAM,KAAK,CAAC,EAAE;YACxBZ,iBAAiB,CAAC4B,MAAM,CAACP,KAAK,CAACvC,UAAU,CAAC;;;;MAIhD,IAAI,CAACoB,OAAO,GAAGH,QAAQ,CAAC8B,IAAI,CAAC,UAAAR,KAAK;QAAA,OAAI,CAACA,KAAK,CAACP,OAAO;MAAA,EAAC;IACvD;IAuBA;;;EAAA;IAAAV,GAAA;IAAAC,KAAA,EAGA,SAAAT,MACEP,KAA6B,EAC7BP,UAAgC;MAEhC,IAAMoC,OAAO,GAAG,IAAI,CAAClB,iBAAiB,CAACmB,GAAG,CAACrC,UAAU,CAAC;MAEtD,IAAIoC,OAAO,EAAE;QACX,IAAIY,2BAA2B,GAAG,KAAK;QAEvC;QACA,IAAMC,eAAe,GAAG,SAAlBA,eAAeA,CAAA,EAAQ;UAC3B1C,KAAK,CAACQ,OAAO,GAAG,IAAI;QACtB,CAAC;QACD;QACA,IAAMmC,wBAAwB,GAAG,SAA3BA,wBAAwBA,CAAA,EAAQ;UACpC3C,KAAK,CAACQ,OAAO,GAAG,IAAI;UACpBiC,2BAA2B,GAAG,IAAI;QACpC,CAAC;QACD,IAAMG,eAAe,GAAmB,EAAE;QAE1C,KAAK,IAAIP,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGR,OAAO,CAACN,MAAM,EAAEc,CAAC,EAAE,EAAE;UACvC,IAAAQ,UAAA,GAA8BhB,OAAO,CAACQ,CAAC,CAAC;YAAjCnB,IAAI,GAAA2B,UAAA,CAAJ3B,IAAI;YAAEC,OAAO,GAAA0B,UAAA,CAAP1B,OAAO;YAAEE,IAAI,GAAAwB,UAAA,CAAJxB,IAAI;UAC1BF,OAAO,CAAAS,aAAA,CAAAA,aAAA,KACF5B,KAAK;YACR;YACAkB,IAAI,EAAJA,IAAI;YACJwB,eAAe,EAAfA,eAAe;YACfC,wBAAwB,EAAxBA;UAAwB,GACxB;UACF,IAAItB,IAAI,EAAE;YACRuB,eAAe,CAACX,IAAI,CAACJ,OAAO,CAACQ,CAAC,CAAC,CAAC;;UAElC,IAAII,2BAA2B,EAAE;YAC/B;;;QAIJ,KAAK,IAAIJ,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGO,eAAe,CAACrB,MAAM,EAAEc,EAAC,EAAE,EAAE;UAC/C,IAAAS,mBAAA,GAAwBF,eAAe,CAACP,EAAC,CAAC;YAAnCnB,KAAI,GAAA4B,mBAAA,CAAJ5B,IAAI;YAAEC,QAAO,GAAA2B,mBAAA,CAAP3B,OAAO;UACpB,IAAI,CAACiB,MAAM,CAAClB,KAAI,EAAEC,QAAO,CAAC;;;IAGhC;IAEA;;;EAAA;IAAAJ,GAAA;IAAAC,KAAA,EAGA,SAAAb,gBAA2CH,KAAQ;MACjD,IAAMM,WAAW,GAAG,IAAI,CAACV,YAAY,CAACmD,UAAU,EAAE;MAElD,OAAAnB,aAAA,CAAAA,aAAA,CAAAA,aAAA,CAAAA,aAAA,KACK5B,KAAK,GACLV,YAAY,CAACU,KAAK,CAAC,GACnBT,iBAAiB,CAACS,KAAK,EAAEM,WAAW,CAAC;QACxC0C,cAAc,EAAE,SAAAA,eAAA,EAAK;UACnBhD,KAAK,CAACK,QAAQ,CAAC2C,cAAc,EAAE;QACjC,CAAC;QACDL,wBAAwB,EAAE,IAAI;QAC9BD,eAAe,EAAE,IAAI;QACrBlC,OAAO,EAAE,KAAK;QACdF,WAAW,EAAXA;MAAW;IAEf;EAAC;EAAA,OAAAX,cAAA;AAAA;AAAA,SA/KkBA,cAAc,IAAAsD,OAAA"},"metadata":{},"sourceType":"module"}