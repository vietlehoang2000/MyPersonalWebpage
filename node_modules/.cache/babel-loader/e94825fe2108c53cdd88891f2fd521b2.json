{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n  return target;\n}\nimport * as React from 'react';\nimport { useContext, useRef, useMemo, useEffect, useImperativeHandle, forwardRef } from 'react';\nimport * as PropTypes from 'prop-types';\nimport StaticMap, { getViewport } from './static-map';\nimport { MAPBOX_LIMITS } from '../utils/map-state';\nimport TransitionManager from '../utils/transition-manager';\nimport MapContext, { MapContextProvider } from './map-context';\nimport { EventManager } from 'mjolnir.js';\nimport MapController from '../utils/map-controller';\nimport useIsomorphicLayoutEffect from '../utils/use-isomorphic-layout-effect';\nimport { getTerrainElevation } from '../utils/terrain';\nvar propTypes = Object.assign({}, StaticMap.propTypes, {\n  maxZoom: PropTypes.number,\n  minZoom: PropTypes.number,\n  maxPitch: PropTypes.number,\n  minPitch: PropTypes.number,\n  onViewStateChange: PropTypes.func,\n  onViewportChange: PropTypes.func,\n  onInteractionStateChange: PropTypes.func,\n  transitionDuration: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  transitionInterpolator: PropTypes.object,\n  transitionInterruption: PropTypes.number,\n  transitionEasing: PropTypes.func,\n  onTransitionStart: PropTypes.func,\n  onTransitionInterrupt: PropTypes.func,\n  onTransitionEnd: PropTypes.func,\n  scrollZoom: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  dragPan: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  dragRotate: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  doubleClickZoom: PropTypes.bool,\n  touchZoom: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  touchRotate: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  keyboard: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  onHover: PropTypes.func,\n  onClick: PropTypes.func,\n  onDblClick: PropTypes.func,\n  onContextMenu: PropTypes.func,\n  onMouseDown: PropTypes.func,\n  onMouseMove: PropTypes.func,\n  onMouseUp: PropTypes.func,\n  onTouchStart: PropTypes.func,\n  onTouchMove: PropTypes.func,\n  onTouchEnd: PropTypes.func,\n  onMouseEnter: PropTypes.func,\n  onMouseLeave: PropTypes.func,\n  onMouseOut: PropTypes.func,\n  onWheel: PropTypes.func,\n  touchAction: PropTypes.string,\n  eventRecognizerOptions: PropTypes.object,\n  clickRadius: PropTypes.number,\n  interactiveLayerIds: PropTypes.array,\n  getCursor: PropTypes.func,\n  controller: PropTypes.instanceOf(MapController)\n});\nvar getDefaultCursor = function getDefaultCursor(_ref) {\n  var isDragging = _ref.isDragging,\n    isHovering = _ref.isHovering;\n  return isDragging ? 'grabbing' : isHovering ? 'pointer' : 'grab';\n};\nvar defaultProps = Object.assign({}, StaticMap.defaultProps, MAPBOX_LIMITS, TransitionManager.defaultProps, {\n  onViewStateChange: null,\n  onViewportChange: null,\n  onClick: null,\n  onNativeClick: null,\n  onHover: null,\n  onContextMenu: function onContextMenu(event) {\n    return event.preventDefault();\n  },\n  scrollZoom: true,\n  dragPan: true,\n  dragRotate: true,\n  doubleClickZoom: true,\n  touchZoom: true,\n  touchRotate: false,\n  keyboard: true,\n  touchAction: 'none',\n  eventRecognizerOptions: {},\n  clickRadius: 0,\n  getCursor: getDefaultCursor\n});\nfunction normalizeEvent(event) {\n  if (event.lngLat || !event.offsetCenter) {\n    return event;\n  }\n  var _event$offsetCenter = event.offsetCenter,\n    x = _event$offsetCenter.x,\n    y = _event$offsetCenter.y;\n  if (!Number.isFinite(x) || !Number.isFinite(y)) {\n    return event;\n  }\n  var pos = [x, y];\n  event.point = pos;\n  if (this.map) {\n    var location = this.map.unproject(pos);\n    event.lngLat = [location.lng, location.lat];\n  }\n  return event;\n}\nfunction getFeatures(pos) {\n  var map = this.map;\n  if (!map || !pos) {\n    return null;\n  }\n  var queryParams = {};\n  var size = this.props.clickRadius;\n  if (this.props.interactiveLayerIds) {\n    queryParams.layers = this.props.interactiveLayerIds;\n  }\n  try {\n    return map.queryRenderedFeatures(size ? [[pos[0] - size, pos[1] + size], [pos[0] + size, pos[1] - size]] : pos, queryParams);\n  } catch (_unused) {\n    return null;\n  }\n}\nfunction onEvent(callbackName, event) {\n  var func = this.props[callbackName];\n  if (func) {\n    func(normalizeEvent.call(this, event));\n  }\n}\nfunction onPointerDown(event) {\n  onEvent.call(this, event.pointerType === 'touch' ? 'onTouchStart' : 'onMouseDown', event);\n}\nfunction onPointerUp(event) {\n  onEvent.call(this, event.pointerType === 'touch' ? 'onTouchEnd' : 'onMouseUp', event);\n}\nfunction onPointerMove(event) {\n  onEvent.call(this, event.pointerType === 'touch' ? 'onTouchMove' : 'onMouseMove', event);\n  if (!this.state.isDragging) {\n    var _this$props = this.props,\n      onHover = _this$props.onHover,\n      interactiveLayerIds = _this$props.interactiveLayerIds;\n    var features;\n    event = normalizeEvent.call(this, event);\n    if (interactiveLayerIds || onHover) {\n      features = getFeatures.call(this, event.point);\n    }\n    var isHovering = Boolean(interactiveLayerIds && features && features.length > 0);\n    var isEntering = isHovering && !this.state.isHovering;\n    var isExiting = !isHovering && this.state.isHovering;\n    if (onHover || isEntering) {\n      event.features = features;\n      if (onHover) {\n        onHover(event);\n      }\n    }\n    if (isEntering) {\n      onEvent.call(this, 'onMouseEnter', event);\n    }\n    if (isExiting) {\n      onEvent.call(this, 'onMouseLeave', event);\n    }\n    if (isEntering || isExiting) {\n      this.setState({\n        isHovering: isHovering\n      });\n    }\n  }\n}\nfunction onPointerClick(event) {\n  var _this$props2 = this.props,\n    onClick = _this$props2.onClick,\n    onNativeClick = _this$props2.onNativeClick,\n    onDblClick = _this$props2.onDblClick,\n    doubleClickZoom = _this$props2.doubleClickZoom;\n  var callbacks = [];\n  var isDoubleClickEnabled = onDblClick || doubleClickZoom;\n  switch (event.type) {\n    case 'anyclick':\n      callbacks.push(onNativeClick);\n      if (!isDoubleClickEnabled) {\n        callbacks.push(onClick);\n      }\n      break;\n    case 'click':\n      if (isDoubleClickEnabled) {\n        callbacks.push(onClick);\n      }\n      break;\n    default:\n  }\n  callbacks = callbacks.filter(Boolean);\n  if (callbacks.length) {\n    event = normalizeEvent.call(this, event);\n    event.features = getFeatures.call(this, event.point);\n    callbacks.forEach(function (cb) {\n      return cb(event);\n    });\n  }\n}\nfunction getRefHandles(staticMapRef) {\n  return {\n    getMap: staticMapRef.current && staticMapRef.current.getMap,\n    queryRenderedFeatures: staticMapRef.current && staticMapRef.current.queryRenderedFeatures\n  };\n}\nvar InteractiveMap = forwardRef(function (props, ref) {\n  var parentContext = useContext(MapContext);\n  var controller = useMemo(function () {\n    return props.controller || new MapController();\n  }, []);\n  var eventManager = useMemo(function () {\n    return new EventManager(null, {\n      touchAction: props.touchAction,\n      recognizerOptions: props.eventRecognizerOptions\n    });\n  }, []);\n  var eventCanvasRef = useRef(null);\n  var staticMapRef = useRef(null);\n  var _thisRef = useRef({\n    width: 0,\n    height: 0,\n    state: {\n      isHovering: false,\n      isDragging: false\n    }\n  });\n  var thisRef = _thisRef.current;\n  thisRef.props = props;\n  thisRef.map = staticMapRef.current && staticMapRef.current.getMap();\n  thisRef.setState = function (newState) {\n    thisRef.state = _objectSpread(_objectSpread({}, thisRef.state), newState);\n    eventCanvasRef.current.style.cursor = props.getCursor(thisRef.state);\n  };\n  var inRender = true;\n  var viewportUpdateRequested;\n  var stateUpdateRequested;\n  var handleViewportChange = function handleViewportChange(viewState, interactionState, oldViewState) {\n    if (inRender) {\n      viewportUpdateRequested = [viewState, interactionState, oldViewState];\n      return;\n    }\n    var _thisRef$props = thisRef.props,\n      onViewStateChange = _thisRef$props.onViewStateChange,\n      onViewportChange = _thisRef$props.onViewportChange;\n    Object.defineProperty(viewState, 'position', {\n      get: function get() {\n        return [0, 0, getTerrainElevation(thisRef.map, viewState)];\n      }\n    });\n    if (onViewStateChange) {\n      onViewStateChange({\n        viewState: viewState,\n        interactionState: interactionState,\n        oldViewState: oldViewState\n      });\n    }\n    if (onViewportChange) {\n      onViewportChange(viewState, interactionState, oldViewState);\n    }\n  };\n  useImperativeHandle(ref, function () {\n    return getRefHandles(staticMapRef);\n  }, []);\n  var context = useMemo(function () {\n    return _objectSpread(_objectSpread({}, parentContext), {}, {\n      eventManager: eventManager,\n      container: parentContext.container || eventCanvasRef.current\n    });\n  }, [parentContext, eventCanvasRef.current]);\n  context.onViewportChange = handleViewportChange;\n  context.viewport = parentContext.viewport || getViewport(thisRef);\n  thisRef.viewport = context.viewport;\n  var handleInteractionStateChange = function handleInteractionStateChange(interactionState) {\n    var _interactionState$isD = interactionState.isDragging,\n      isDragging = _interactionState$isD === void 0 ? false : _interactionState$isD;\n    if (isDragging !== thisRef.state.isDragging) {\n      thisRef.setState({\n        isDragging: isDragging\n      });\n    }\n    if (inRender) {\n      stateUpdateRequested = interactionState;\n      return;\n    }\n    var onInteractionStateChange = thisRef.props.onInteractionStateChange;\n    if (onInteractionStateChange) {\n      onInteractionStateChange(interactionState);\n    }\n  };\n  var updateControllerOpts = function updateControllerOpts() {\n    if (thisRef.width && thisRef.height) {\n      controller.setOptions(_objectSpread(_objectSpread(_objectSpread({}, thisRef.props), thisRef.props.viewState), {}, {\n        isInteractive: Boolean(thisRef.props.onViewStateChange || thisRef.props.onViewportChange),\n        onViewportChange: handleViewportChange,\n        onStateChange: handleInteractionStateChange,\n        eventManager: eventManager,\n        width: thisRef.width,\n        height: thisRef.height\n      }));\n    }\n  };\n  var onResize = function onResize(_ref2) {\n    var width = _ref2.width,\n      height = _ref2.height;\n    thisRef.width = width;\n    thisRef.height = height;\n    updateControllerOpts();\n    thisRef.props.onResize({\n      width: width,\n      height: height\n    });\n  };\n  useEffect(function () {\n    eventManager.setElement(eventCanvasRef.current);\n    eventManager.on({\n      pointerdown: onPointerDown.bind(thisRef),\n      pointermove: onPointerMove.bind(thisRef),\n      pointerup: onPointerUp.bind(thisRef),\n      pointerleave: onEvent.bind(thisRef, 'onMouseOut'),\n      click: onPointerClick.bind(thisRef),\n      anyclick: onPointerClick.bind(thisRef),\n      dblclick: onEvent.bind(thisRef, 'onDblClick'),\n      wheel: onEvent.bind(thisRef, 'onWheel'),\n      contextmenu: onEvent.bind(thisRef, 'onContextMenu')\n    });\n    return function () {\n      eventManager.destroy();\n    };\n  }, []);\n  useIsomorphicLayoutEffect(function () {\n    if (viewportUpdateRequested) {\n      handleViewportChange.apply(void 0, _toConsumableArray(viewportUpdateRequested));\n    }\n    if (stateUpdateRequested) {\n      handleInteractionStateChange(stateUpdateRequested);\n    }\n  });\n  updateControllerOpts();\n  var width = props.width,\n    height = props.height,\n    style = props.style,\n    getCursor = props.getCursor;\n  var eventCanvasStyle = useMemo(function () {\n    return _objectSpread(_objectSpread({\n      position: 'relative'\n    }, style), {}, {\n      width: width,\n      height: height,\n      cursor: getCursor(thisRef.state)\n    });\n  }, [style, width, height, getCursor, thisRef.state]);\n  if (!viewportUpdateRequested || !thisRef._child) {\n    thisRef._child = React.createElement(MapContextProvider, {\n      value: context\n    }, React.createElement(\"div\", {\n      key: \"event-canvas\",\n      ref: eventCanvasRef,\n      style: eventCanvasStyle\n    }, React.createElement(StaticMap, _extends({}, props, {\n      width: \"100%\",\n      height: \"100%\",\n      style: null,\n      onResize: onResize,\n      ref: staticMapRef\n    }))));\n  }\n  inRender = false;\n  return thisRef._child;\n});\nInteractiveMap.supported = StaticMap.supported;\nInteractiveMap.propTypes = propTypes;\nInteractiveMap.defaultProps = defaultProps;\nexport default InteractiveMap;","map":{"version":3,"names":["React","useContext","useRef","useMemo","useEffect","useImperativeHandle","forwardRef","PropTypes","StaticMap","getViewport","MAPBOX_LIMITS","TransitionManager","MapContext","MapContextProvider","EventManager","MapController","useIsomorphicLayoutEffect","getTerrainElevation","propTypes","Object","assign","maxZoom","number","minZoom","maxPitch","minPitch","onViewStateChange","func","onViewportChange","onInteractionStateChange","transitionDuration","oneOfType","string","transitionInterpolator","object","transitionInterruption","transitionEasing","onTransitionStart","onTransitionInterrupt","onTransitionEnd","scrollZoom","bool","dragPan","dragRotate","doubleClickZoom","touchZoom","touchRotate","keyboard","onHover","onClick","onDblClick","onContextMenu","onMouseDown","onMouseMove","onMouseUp","onTouchStart","onTouchMove","onTouchEnd","onMouseEnter","onMouseLeave","onMouseOut","onWheel","touchAction","eventRecognizerOptions","clickRadius","interactiveLayerIds","array","getCursor","controller","instanceOf","getDefaultCursor","_ref","isDragging","isHovering","defaultProps","onNativeClick","event","preventDefault","normalizeEvent","lngLat","offsetCenter","_event$offsetCenter","x","y","Number","isFinite","pos","point","map","location","unproject","lng","lat","getFeatures","queryParams","size","props","layers","queryRenderedFeatures","_unused","onEvent","callbackName","call","onPointerDown","pointerType","onPointerUp","onPointerMove","state","_this$props","features","Boolean","length","isEntering","isExiting","setState","onPointerClick","_this$props2","callbacks","isDoubleClickEnabled","type","push","filter","forEach","cb","getRefHandles","staticMapRef","getMap","current","InteractiveMap","ref","parentContext","eventManager","recognizerOptions","eventCanvasRef","_thisRef","width","height","thisRef","newState","_objectSpread","style","cursor","inRender","viewportUpdateRequested","stateUpdateRequested","handleViewportChange","viewState","interactionState","oldViewState","_thisRef$props","defineProperty","get","context","container","viewport","handleInteractionStateChange","_interactionState$isD","updateControllerOpts","setOptions","isInteractive","onStateChange","onResize","_ref2","setElement","on","pointerdown","bind","pointermove","pointerup","pointerleave","click","anyclick","dblclick","wheel","contextmenu","destroy","apply","_toConsumableArray","eventCanvasStyle","position","_child","createElement","value","key","_extends","supported"],"sources":["../../../src/components/interactive-map.js"],"sourcesContent":["import * as React from 'react';\nimport {useContext, useRef, useMemo, useEffect, useImperativeHandle, forwardRef} from 'react';\nimport * as PropTypes from 'prop-types';\n\nimport StaticMap, {getViewport} from './static-map';\nimport {MAPBOX_LIMITS} from '../utils/map-state';\n\nimport TransitionManager from '../utils/transition-manager';\nimport MapContext, {MapContextProvider} from './map-context';\n\nimport {EventManager} from 'mjolnir.js';\nimport MapController from '../utils/map-controller';\nimport useIsomorphicLayoutEffect from '../utils/use-isomorphic-layout-effect';\nimport {getTerrainElevation} from '../utils/terrain';\n\nconst propTypes = Object.assign({}, StaticMap.propTypes, {\n  // Additional props on top of StaticMap\n\n  /** Viewport constraints */\n  // Max zoom level\n  maxZoom: PropTypes.number,\n  // Min zoom level\n  minZoom: PropTypes.number,\n  // Max pitch in degrees\n  maxPitch: PropTypes.number,\n  // Min pitch in degrees\n  minPitch: PropTypes.number,\n\n  // Callbacks fired when the user interacted with the map. The object passed to the callbacks\n  // contains viewport properties such as `longitude`, `latitude`, `zoom` etc.\n  onViewStateChange: PropTypes.func,\n  onViewportChange: PropTypes.func,\n  onInteractionStateChange: PropTypes.func,\n\n  /** Viewport transition **/\n  // transition duration for viewport change\n  transitionDuration: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  // TransitionInterpolator instance, can be used to perform custom transitions.\n  transitionInterpolator: PropTypes.object,\n  // type of interruption of current transition on update.\n  transitionInterruption: PropTypes.number,\n  // easing function\n  transitionEasing: PropTypes.func,\n  // transition status update functions\n  onTransitionStart: PropTypes.func,\n  onTransitionInterrupt: PropTypes.func,\n  onTransitionEnd: PropTypes.func,\n\n  /** Enables control event handling */\n  // Scroll to zoom\n  scrollZoom: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  // Drag to pan\n  dragPan: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  // Drag to rotate\n  dragRotate: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  // Double click to zoom\n  doubleClickZoom: PropTypes.bool,\n  // Multitouch zoom\n  touchZoom: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  // Multitouch rotate\n  touchRotate: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n  // Keyboard\n  keyboard: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n\n  /** Event callbacks */\n  onHover: PropTypes.func,\n  onClick: PropTypes.func,\n  onDblClick: PropTypes.func,\n  onContextMenu: PropTypes.func,\n  onMouseDown: PropTypes.func,\n  onMouseMove: PropTypes.func,\n  onMouseUp: PropTypes.func,\n  onTouchStart: PropTypes.func,\n  onTouchMove: PropTypes.func,\n  onTouchEnd: PropTypes.func,\n  onMouseEnter: PropTypes.func,\n  onMouseLeave: PropTypes.func,\n  onMouseOut: PropTypes.func,\n  onWheel: PropTypes.func,\n\n  /** Custom touch-action CSS for the event canvas. Defaults to 'none' */\n  touchAction: PropTypes.string,\n\n  /** Custom hammer.js recognizer options */\n  eventRecognizerOptions: PropTypes.object,\n\n  /** Radius to detect features around a clicked point. Defaults to 0. */\n  clickRadius: PropTypes.number,\n\n  /** List of layers that are interactive */\n  interactiveLayerIds: PropTypes.array,\n\n  /** Accessor that returns a cursor style to show interactive state */\n  getCursor: PropTypes.func,\n\n  // A map control instance to replace the default map controller\n  // The object must expose a method: `setOptions(opts)`\n  controller: PropTypes.instanceOf(MapController)\n});\n\nconst getDefaultCursor = ({isDragging, isHovering}) =>\n  isDragging ? 'grabbing' : isHovering ? 'pointer' : 'grab';\n\nconst defaultProps = Object.assign(\n  {},\n  StaticMap.defaultProps,\n  MAPBOX_LIMITS,\n  TransitionManager.defaultProps,\n  {\n    onViewStateChange: null,\n    onViewportChange: null,\n    onClick: null,\n    onNativeClick: null,\n    onHover: null,\n    onContextMenu: event => event.preventDefault(),\n\n    scrollZoom: true,\n    dragPan: true,\n    dragRotate: true,\n    doubleClickZoom: true,\n    touchZoom: true,\n    touchRotate: false,\n    keyboard: true,\n\n    touchAction: 'none',\n    eventRecognizerOptions: {},\n    clickRadius: 0,\n    getCursor: getDefaultCursor\n  }\n);\n\n/* Event handlers */\nfunction normalizeEvent(event) {\n  if (event.lngLat || !event.offsetCenter) {\n    return event;\n  }\n\n  const {\n    offsetCenter: {x, y}\n  } = event;\n  // https://github.com/visgl/react-map-gl/issues/1449\n  // TODO - fix in mjolnir.js\n  if (!Number.isFinite(x) || !Number.isFinite(y)) {\n    return event;\n  }\n  const pos = [x, y];\n\n  event.point = pos;\n\n  if (this.map) {\n    const location = this.map.unproject(pos);\n    event.lngLat = [location.lng, location.lat];\n  }\n\n  return event;\n}\n\nfunction getFeatures(pos) {\n  const {map} = this;\n\n  if (!map || !pos) {\n    return null;\n  }\n\n  const queryParams = {};\n  const size = this.props.clickRadius;\n\n  if (this.props.interactiveLayerIds) {\n    queryParams.layers = this.props.interactiveLayerIds;\n  }\n\n  try {\n    // This may fail if map is still loading\n    return map.queryRenderedFeatures(\n      size\n        ? // Radius enables point features, like marker symbols, to be clicked.\n          [\n            [pos[0] - size, pos[1] + size],\n            [pos[0] + size, pos[1] - size]\n          ]\n        : pos,\n      queryParams\n    );\n  } catch {\n    return null;\n  }\n}\n\nfunction onEvent(callbackName, event) {\n  const func = this.props[callbackName];\n  if (func) {\n    func(normalizeEvent.call(this, event));\n  }\n}\n\nfunction onPointerDown(event) {\n  onEvent.call(this, event.pointerType === 'touch' ? 'onTouchStart' : 'onMouseDown', event);\n}\n\nfunction onPointerUp(event) {\n  onEvent.call(this, event.pointerType === 'touch' ? 'onTouchEnd' : 'onMouseUp', event);\n}\n\n// eslint-disable-next-line complexity\nfunction onPointerMove(event) {\n  onEvent.call(this, event.pointerType === 'touch' ? 'onTouchMove' : 'onMouseMove', event);\n\n  if (!this.state.isDragging) {\n    const {onHover, interactiveLayerIds} = this.props;\n    let features;\n    event = normalizeEvent.call(this, event);\n    if (interactiveLayerIds || onHover) {\n      features = getFeatures.call(this, event.point);\n    }\n\n    const isHovering = Boolean(interactiveLayerIds && features && features.length > 0);\n    const isEntering = isHovering && !this.state.isHovering;\n    const isExiting = !isHovering && this.state.isHovering;\n\n    if (onHover || isEntering) {\n      event.features = features;\n\n      // backward compatibility: v3 `onHover` interface\n      if (onHover) {\n        onHover(event);\n      }\n    }\n\n    if (isEntering) {\n      onEvent.call(this, 'onMouseEnter', event);\n    }\n    if (isExiting) {\n      onEvent.call(this, 'onMouseLeave', event);\n    }\n    if (isEntering || isExiting) {\n      this.setState({isHovering});\n    }\n  }\n}\n\nfunction onPointerClick(event) {\n  const {onClick, onNativeClick, onDblClick, doubleClickZoom} = this.props;\n  let callbacks = [];\n  const isDoubleClickEnabled = onDblClick || doubleClickZoom;\n\n  // `click` is only fired on single click. `anyclick` is fired twice if double clicking.\n  // `click` has a delay period after pointer up that prevents it from firing when\n  // double clicking. `anyclick` is always fired immediately after pointer up.\n  // If double click is turned off by the user, we want to immediately fire the\n  // onClick event. Otherwise, we wait to make sure it's a single click.\n  switch (event.type) {\n    case 'anyclick':\n      callbacks.push(onNativeClick);\n      if (!isDoubleClickEnabled) {\n        callbacks.push(onClick);\n      }\n      break;\n\n    case 'click':\n      if (isDoubleClickEnabled) {\n        callbacks.push(onClick);\n      }\n      break;\n\n    default:\n  }\n\n  callbacks = callbacks.filter(Boolean);\n\n  if (callbacks.length) {\n    event = normalizeEvent.call(this, event);\n    // backward compatibility: v3 `onClick` interface\n    event.features = getFeatures.call(this, event.point);\n    callbacks.forEach(cb => cb(event));\n  }\n}\n/* End of event handers */\n\nfunction getRefHandles(staticMapRef) {\n  return {\n    getMap: staticMapRef.current && staticMapRef.current.getMap,\n    queryRenderedFeatures: staticMapRef.current && staticMapRef.current.queryRenderedFeatures\n  };\n}\n\n/* eslint-disable max-statements */\nconst InteractiveMap = forwardRef((props, ref) => {\n  const parentContext = useContext(MapContext);\n  const controller = useMemo(() => props.controller || new MapController(), []);\n  const eventManager = useMemo(\n    () =>\n      new EventManager(null, {\n        touchAction: props.touchAction,\n        recognizerOptions: props.eventRecognizerOptions\n      }),\n    []\n  );\n  const eventCanvasRef = useRef(null);\n  const staticMapRef = useRef(null);\n\n  // Event handlers are registered once but need access to the latest props\n  // This is an anti-pattern, though it maintains a persistent reference to the latest props/state of this component\n  const _thisRef = useRef({\n    width: 0,\n    height: 0,\n    state: {\n      isHovering: false,\n      isDragging: false\n    }\n  });\n  const thisRef = _thisRef.current;\n  thisRef.props = props;\n  thisRef.map = staticMapRef.current && staticMapRef.current.getMap();\n  thisRef.setState = newState => {\n    thisRef.state = {...thisRef.state, ...newState};\n    eventCanvasRef.current.style.cursor = props.getCursor(thisRef.state);\n  };\n\n  let inRender = true;\n  let viewportUpdateRequested;\n  let stateUpdateRequested;\n\n  const handleViewportChange = (viewState, interactionState, oldViewState) => {\n    if (inRender) {\n      // Do not call the callbacks during render - may result in \"cannot update during an existing state transition\" error.\n      // Defer the update until after render\n      viewportUpdateRequested = [viewState, interactionState, oldViewState];\n      return;\n    }\n    const {onViewStateChange, onViewportChange} = thisRef.props;\n\n    /* eslint-disable accessor-pairs */\n    Object.defineProperty(viewState, 'position', {\n      get: () => [0, 0, getTerrainElevation(thisRef.map, viewState)]\n    });\n\n    if (onViewStateChange) {\n      onViewStateChange({viewState, interactionState, oldViewState});\n    }\n    if (onViewportChange) {\n      onViewportChange(viewState, interactionState, oldViewState);\n    }\n  };\n\n  useImperativeHandle(ref, () => getRefHandles(staticMapRef), []);\n\n  const context = useMemo(\n    () => ({\n      ...parentContext,\n      eventManager,\n      container: parentContext.container || eventCanvasRef.current\n    }),\n    [parentContext, eventCanvasRef.current]\n  );\n  context.onViewportChange = handleViewportChange;\n  context.viewport = parentContext.viewport || getViewport(thisRef);\n  thisRef.viewport = context.viewport;\n\n  const handleInteractionStateChange = interactionState => {\n    const {isDragging = false} = interactionState;\n    if (isDragging !== thisRef.state.isDragging) {\n      thisRef.setState({isDragging});\n    }\n\n    if (inRender) {\n      // Do not call the callbacks during render - may result in \"cannot update during an existing state transition\" error.\n      // Defer the update until after render\n      stateUpdateRequested = interactionState;\n      return;\n    }\n\n    const {onInteractionStateChange} = thisRef.props;\n    if (onInteractionStateChange) {\n      onInteractionStateChange(interactionState);\n    }\n  };\n\n  const updateControllerOpts = () => {\n    if (thisRef.width && thisRef.height) {\n      controller.setOptions({\n        ...thisRef.props,\n        ...thisRef.props.viewState,\n        isInteractive: Boolean(thisRef.props.onViewStateChange || thisRef.props.onViewportChange),\n        onViewportChange: handleViewportChange,\n        onStateChange: handleInteractionStateChange,\n        eventManager,\n        width: thisRef.width,\n        height: thisRef.height\n      });\n    }\n  };\n\n  const onResize = ({width, height}) => {\n    thisRef.width = width;\n    thisRef.height = height;\n    updateControllerOpts();\n    thisRef.props.onResize({width, height});\n  };\n\n  useEffect(() => {\n    eventManager.setElement(eventCanvasRef.current);\n    // Register event handlers\n    eventManager.on({\n      pointerdown: onPointerDown.bind(thisRef),\n      pointermove: onPointerMove.bind(thisRef),\n      pointerup: onPointerUp.bind(thisRef),\n      pointerleave: onEvent.bind(thisRef, 'onMouseOut'),\n      click: onPointerClick.bind(thisRef),\n      anyclick: onPointerClick.bind(thisRef),\n      dblclick: onEvent.bind(thisRef, 'onDblClick'),\n      wheel: onEvent.bind(thisRef, 'onWheel'),\n      contextmenu: onEvent.bind(thisRef, 'onContextMenu')\n    });\n\n    // Clean up on unmount\n    return () => {\n      eventManager.destroy();\n    };\n  }, []);\n\n  useIsomorphicLayoutEffect(() => {\n    if (viewportUpdateRequested) {\n      // Perform deferred updates\n      handleViewportChange(...viewportUpdateRequested);\n    }\n    if (stateUpdateRequested) {\n      handleInteractionStateChange(stateUpdateRequested);\n    }\n  });\n\n  updateControllerOpts();\n\n  const {width, height, style, getCursor} = props;\n\n  const eventCanvasStyle = useMemo(\n    () => ({\n      position: 'relative',\n      ...style,\n      width,\n      height,\n      cursor: getCursor(thisRef.state)\n    }),\n    [style, width, height, getCursor, thisRef.state]\n  );\n\n  if (!viewportUpdateRequested || !thisRef._child) {\n    // Only rerender if no viewport update has been requested during render.\n    // Otherwise return the last rendered child, and invoke the callback when we're done.\n    thisRef._child = (\n      <MapContextProvider value={context}>\n        <div key=\"event-canvas\" ref={eventCanvasRef} style={eventCanvasStyle}>\n          <StaticMap\n            {...props}\n            width=\"100%\"\n            height=\"100%\"\n            style={null}\n            onResize={onResize}\n            ref={staticMapRef}\n          />\n        </div>\n      </MapContextProvider>\n    );\n  }\n\n  inRender = false;\n  return thisRef._child;\n});\n\nInteractiveMap.supported = StaticMap.supported;\nInteractiveMap.propTypes = propTypes;\nInteractiveMap.defaultProps = defaultProps;\n\nexport default InteractiveMap;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}