{"ast":null,"code":"import { worldToLngLat } from './web-mercator-utils';\nimport { mod, log2 } from './math-utils';\nvar TILE_SIZE = 512;\nexport default function normalizeViewportProps(props) {\n  var width = props.width,\n    height = props.height,\n    _props$pitch = props.pitch,\n    pitch = _props$pitch === void 0 ? 0 : _props$pitch;\n  var longitude = props.longitude,\n    latitude = props.latitude,\n    zoom = props.zoom,\n    _props$bearing = props.bearing,\n    bearing = _props$bearing === void 0 ? 0 : _props$bearing;\n  if (longitude < -180 || longitude > 180) {\n    longitude = mod(longitude + 180, 360) - 180;\n  }\n  if (bearing < -180 || bearing > 180) {\n    bearing = mod(bearing + 180, 360) - 180;\n  }\n  var minZoom = log2(height / TILE_SIZE);\n  if (zoom <= minZoom) {\n    zoom = minZoom;\n    latitude = 0;\n  } else {\n    var halfHeightPixels = height / 2 / Math.pow(2, zoom);\n    var minLatitude = worldToLngLat([0, halfHeightPixels])[1];\n    if (latitude < minLatitude) {\n      latitude = minLatitude;\n    } else {\n      var maxLatitude = worldToLngLat([0, TILE_SIZE - halfHeightPixels])[1];\n      if (latitude > maxLatitude) {\n        latitude = maxLatitude;\n      }\n    }\n  }\n  return {\n    width: width,\n    height: height,\n    longitude: longitude,\n    latitude: latitude,\n    zoom: zoom,\n    pitch: pitch,\n    bearing: bearing\n  };\n}","map":{"version":3,"names":["worldToLngLat","mod","log2","TILE_SIZE","normalizeViewportProps","props","width","height","_props$pitch","pitch","longitude","latitude","zoom","_props$bearing","bearing","minZoom","halfHeightPixels","Math","pow","minLatitude","maxLatitude"],"sources":["../../src/normalize-viewport-props.ts"],"sourcesContent":["import {worldToLngLat} from './web-mercator-utils';\nimport {mod, log2} from './math-utils';\n\n// defined by mapbox-gl\nconst TILE_SIZE = 512;\n\n/** Description of viewport */\nexport type ViewportProps = {\n  width: number;\n  height: number;\n  longitude: number;\n  latitude: number;\n  zoom: number;\n  pitch?: number;\n  bearing?: number;\n};\n\n/**\n * Apply mathematical constraints to viewport props\n * @param props\n */\n// eslint-disable-next-line complexity\nexport default function normalizeViewportProps(props: ViewportProps): ViewportProps {\n  const {width, height, pitch = 0} = props;\n  let {longitude, latitude, zoom, bearing = 0} = props;\n\n  // Normalize degrees\n  if (longitude < -180 || longitude > 180) {\n    longitude = mod(longitude + 180, 360) - 180;\n  }\n  if (bearing < -180 || bearing > 180) {\n    bearing = mod(bearing + 180, 360) - 180;\n  }\n\n  // Constrain zoom and shift center at low zoom levels\n  const minZoom = log2(height / TILE_SIZE);\n  if (zoom <= minZoom) {\n    zoom = minZoom;\n    latitude = 0;\n  } else {\n    // Eliminate white space above and below the map\n    const halfHeightPixels = height / 2 / Math.pow(2, zoom);\n    const minLatitude = worldToLngLat([0, halfHeightPixels])[1];\n    if (latitude < minLatitude) {\n      latitude = minLatitude;\n    } else {\n      const maxLatitude = worldToLngLat([0, TILE_SIZE - halfHeightPixels])[1];\n      if (latitude > maxLatitude) {\n        latitude = maxLatitude;\n      }\n    }\n  }\n\n  return {width, height, longitude, latitude, zoom, pitch, bearing};\n}\n"],"mappings":"AAAA,SAAQA,aAAR,QAA4B,sBAA5B;AACA,SAAQC,GAAR,EAAaC,IAAb,QAAwB,cAAxB;AAGA,IAAMC,SAAS,GAAG,GAAlB;AAkBA,eAAe,SAASC,sBAATA,CAAgCC,KAAhC,EAAqE;EAClF,IAAOC,KAAD,GAA6BD,KAAnC,CAAOC,KAAD;IAAQC,MAAR,GAA6BF,KAAnC,CAAcE,MAAR;IAAAC,YAAA,GAA6BH,KAAnC,CAAsBI,KAAK;IAALA,KAAK,GAAAD,YAAA,cAAG,IAAAA,YAAA;EAC9B,IAAKE,SAAD,GAA2CL,KAA/C,CAAKK,SAAD;IAAYC,QAAZ,GAA2CN,KAA/C,CAAgBM,QAAZ;IAAsBC,IAAtB,GAA2CP,KAA/C,CAA0BO,IAAtB;IAAAC,cAAA,GAA2CR,KAA/C,CAAgCS,OAAO;IAAPA,OAAO,GAAAD,cAAA,cAAG,IAAAA,cAAA;EAG1C,IAAIH,SAAS,GAAG,CAAC,GAAb,IAAoBA,SAAS,GAAG,GAApC,EAAyC;IACvCA,SAAS,GAAGT,GAAG,CAACS,SAAS,GAAG,GAAb,EAAkB,GAAlB,CAAH,GAA4B,GAAxC;EACD;EACD,IAAII,OAAO,GAAG,CAAC,GAAX,IAAkBA,OAAO,GAAG,GAAhC,EAAqC;IACnCA,OAAO,GAAGb,GAAG,CAACa,OAAO,GAAG,GAAX,EAAgB,GAAhB,CAAH,GAA0B,GAApC;EACD;EAGD,IAAMC,OAAO,GAAGb,IAAI,CAACK,MAAM,GAAGJ,SAAV,CAApB;EACA,IAAIS,IAAI,IAAIG,OAAZ,EAAqB;IACnBH,IAAI,GAAGG,OAAP;IACAJ,QAAQ,GAAG,CAAX;EACD,CAHD,MAGO;IAEL,IAAMK,gBAAgB,GAAGT,MAAM,GAAG,CAAT,GAAaU,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYN,IAAZ,CAAtC;IACA,IAAMO,WAAW,GAAGnB,aAAa,CAAC,CAAC,CAAD,EAAIgB,gBAAJ,CAAD,CAAb,CAAqC,CAArC,CAApB;IACA,IAAIL,QAAQ,GAAGQ,WAAf,EAA4B;MAC1BR,QAAQ,GAAGQ,WAAX;IACD,CAFD,MAEO;MACL,IAAMC,WAAW,GAAGpB,aAAa,CAAC,CAAC,CAAD,EAAIG,SAAS,GAAGa,gBAAhB,CAAD,CAAb,CAAiD,CAAjD,CAApB;MACA,IAAIL,QAAQ,GAAGS,WAAf,EAA4B;QAC1BT,QAAQ,GAAGS,WAAX;MACD;IACF;EACF;EAED,OAAO;IAACd,KAAD,EAACA,KAAD;IAAQC,MAAR,EAAQA,MAAR;IAAgBG,SAAhB,EAAgBA,SAAhB;IAA2BC,QAA3B,EAA2BA,QAA3B;IAAqCC,IAArC,EAAqCA,IAArC;IAA2CH,KAA3C,EAA2CA,KAA3C;IAAkDK,OAAA,EAAAA;EAAlD,CAAP;AACD"},"metadata":{},"sourceType":"module"}